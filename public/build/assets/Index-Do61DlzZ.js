import{u as M,m as $,o as f,f as s,t as d,k as r,l as T,C as L,H as K,I as G,i as b,q as N,w as v,p as E,J as F,A as Q,K as W,L as X,D as H,y as Y,e as V,n as z,F as Z,v as ee,M as te,N as ae,O as se,E as I}from"./vendor-CMULZhQa.js";import{A as le}from"./AdminLayout-BMfLiLo0.js";import{T as re}from"./TitlePage-DOI2IMRH.js";import{_ as oe}from"./DefaultButton-CB_WTPCQ.js";import{_ as ie,a as ne,b as ce}from"./CountTable-CMYQTUCB.js";import{_ as de}from"./ActivityToggle-Cte8AC4X.js";import{_ as ue}from"./IconEdit-C4DN4M8M.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-axios-jn5v1YEJ.js";import"./vendor-lodash-3g6-h99u.js";import"./sidebarIcons-D5nT6JI0.js";import"./ResponsiveNavLink-BBt1gw6L.js";import"./ScrollButtons-DjRj6zOj.js";import"./app-BmuzEqX8.js";import"./auth-image-XbvYdkSi.js";const me={class:"flex flex-col sm:flex-row items-center"},he={class:"block mb-2 sm:mb-0 sm:mr-2 font-semibold text-sm text-slate-700 dark:text-slate-500"},ve={value:"",disabled:"",selected:""},fe={value:"selectAll"},ye={value:"deselectAll"},be={value:"activate"},xe={value:"deactivate"},ke={__name:"BulkActionSelect",props:{handleBulkAction:Function},emits:["change"],setup(e,{emit:m}){const{t:o}=M();return(C,h)=>(f(),$("div",me,[s("label",he,d(r(o)("bulkActions")),1),s("select",{class:"w-auto px-3 py-0.5 form-select bg-white dark:bg-gray-200 text-gray-600 dark:text-gray-900 border border-slate-400 dark:border-slate-600 rounded-sm shadow-sm",onChange:h[0]||(h[0]=y=>C.$emit("change",y))},[s("option",ve,d(r(o)("selectAction")),1),s("option",fe,d(r(o)("selectAll")),1),s("option",ye,d(r(o)("deselectAll")),1),s("option",be,d(r(o)("activate")),1),s("option",xe,d(r(o)("deactivate")),1)],32)]))}},pe={class:"flex items-center justify-between py-1 px-3 border border-gray-400 rounded-sm bg-white dark:bg-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 transition duration-150 ease-in-out"},we={class:"flex items-center space-x-2 flex-grow min-w-0"},$e=["title"],Ce=s("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",class:"w-4 h-4"},[s("path",{class:"fill-current text-sky-500 dark:text-sky-200",d:"M278.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8l32 0 0 96-96 0 0-32c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6l0-32 96 0 0 96-32 0c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8l-32 0 0-96 96 0 0 32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 32-96 0 0-96 32 0c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64z"})],-1),Ae=[Ce],Se=["title"],Te=s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1),_e=[Te],De={key:1,class:"w-4 h-4 inline-block flex-shrink-0"},Ie=["checked"],Ee={class:"font-semibold text-sm text-amber-600 dark:text-amber-200 mr-1 flex-shrink-0"},Ve={class:"flex justify-center"},je=["src","alt","title"],Be=["alt"],Le={class:"flex items-center space-x-1 flex-shrink-0 ml-4"},Ne={class:"children-container mt-1"},Me={__name:"CategoryTreeItem",props:{category:Object,level:Number,selectedCategories:Array},emits:["toggle-activity","delete","toggle-select","request-drag-end"],setup(e,{emit:m}){const{t:o}=M(),C=e,h=m,y=T(!0);L(()=>C.category,(i,n)=>{},{deep:!0}),L(()=>C.selectedCategories,(i,n)=>{},{deep:!0});const A=i=>{h("request-drag-end",i)},_=()=>{y.value=!y.value},S=i=>i.images&&i.images.length?[...i.images].sort((n,D)=>n.order-D.order)[0]:null;return(i,n)=>{const D=K("CategoryTreeItem",!0);return f(),$("div",null,[s("div",{class:"category-item mb-1",style:W({marginLeft:e.level*20+"px"})},[s("div",pe,[s("div",we,[s("span",{class:"handle cursor-move mr-1 flex-shrink-0",title:r(o)("dragDrop")},Ae,8,$e),e.category.children&&e.category.children.length?(f(),$("button",{key:0,title:y.value?r(o)("collapse"):r(o)("expand"),onClick:_,class:"flex-shrink-0 text-slate-900 hover:text-red-500 dark:text-slate-100 dark:hover:text-red-200"},[(f(),$("svg",{class:N(["w-5 h-5 transform transition-transform duration-150",{"rotate-90":y.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},_e,2))],8,Se)):(f(),$("span",De)),s("input",{type:"checkbox",checked:e.selectedCategories.includes(e.category.id),onChange:n[0]||(n[0]=p=>i.$emit("toggle-select",e.category.id)),class:"form-checkbox rounded-sm text-indigo-500 flex-shrink-0"},null,40,Ie),s("span",Ee,d(e.category.id),1),b(r(F),{href:i.route("public.categories.show",{category:e.category.url}),class:"font-medium text-teal-600 dark:text-teal-100 hover:underline hover:text-indigo-600 dark:hover:text-indigo-300 truncate",title:e.category.url},{default:v(()=>[E(d(e.category.title),1)]),_:1},8,["href","title"]),s("span",{class:N(["text-xs ml-1 px-1.5 py-0.5 rounded-sm border border-slate-400 flex-shrink-0",e.category.activity?"bg-amber-100 dark:bg-amber-700/50 text-amber-700 dark:text-amber-300":"bg-blue-200 dark:bg-blue-900/50 text-gray-900 dark:text-gray-100"])},d(e.category.locale.toUpperCase()),3),s("div",Ve,[e.category.images&&e.category.images.length?(f(),$("img",{key:0,src:S(e.category).webp_url||S(e.category).url,alt:S(e.category).alt||r(o)("defaultImageAlt"),title:S(e.category).caption||r(o)("postImage"),class:"h-6 w-8 object-cover rounded-sm border border-slate-400 dark:border-slate-200 p-0.5"},null,8,je)):(f(),$("img",{key:1,src:"/storage/category_images/default-image.png",alt:r(o)("defaultImageTitle"),class:"h-6 w-8 object-cover rounded-sm border border-slate-400 dark:border-slate-200 p-0.5"},null,8,Be))])]),s("div",Le,[b(de,{isActive:e.category.activity,onToggleActivity:n[1]||(n[1]=p=>i.$emit("toggle-activity",e.category)),title:e.category.activity?r(o)("enabled"):r(o)("disabled")},null,8,["isActive","title"]),b(ue,{href:i.route("admin.categories.edit",e.category.id)},null,8,["href"]),b(ie,{onClick:n[2]||(n[2]=Q(p=>i.$emit("delete",e.category),["stop"]))})])])],4),G(s("div",Ne,[b(r(H),{modelValue:e.category.children,"onUpdate:modelValue":n[6]||(n[6]=p=>e.category.children=p),tag:"div","item-key":"id",handle:".handle",group:"categories",onEnd:A,class:"category-tree-children","data-parent-id":e.category.id},{item:v(({element:p})=>[b(D,{category:p,level:e.level+1,"selected-categories":e.selectedCategories,onToggleActivity:n[3]||(n[3]=u=>i.$emit("toggle-activity",u)),onDelete:n[4]||(n[4]=u=>i.$emit("delete",u)),onToggleSelect:n[5]||(n[5]=u=>i.$emit("toggle-select",u)),onRequestDragEnd:A},null,8,["category","level","selected-categories"])]),_:1},8,["modelValue","data-parent-id"])],512),[[X,y.value&&e.category.children&&e.category.children.length]])])}}},Oe=e=>(ae("data-v-5f671a35"),e=e(),se(),e),Ue={class:"px-2 py-2 w-full max-w-12xl mx-auto"},qe={class:"p-4 bg-slate-50 dark:bg-slate-700 border border-blue-400 dark:border-blue-200 overflow-hidden shadow-md shadow-gray-500 dark:shadow-slate-400 bg-opacity-95 dark:bg-opacity-95"},ze={class:"sm:flex sm:justify-between sm:items-center mb-2"},Fe=Oe(()=>s("svg",{class:"w-4 h-4 fill-current opacity-50 shrink-0",viewBox:"0 0 16 16"},[s("path",{d:"M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z"})],-1)),He={class:"flex items-center justify-between mt-5"},Je={class:"flex items-center justify-end space-x-2 px-3 py-1 border-x border-t border-gray-400 rounded-t-lg bg-gray-100 dark:bg-gray-900"},Pe={class:"text-sm font-medium text-slate-700 dark:text-slate-200"},Re={class:"flex items-center"},Ke=["title"],Ge={class:"bg-gray-300 dark:bg-gray-900 border border-gray-400 relative"},Qe={class:"p-4 text-center text-slate-500 dark:text-slate-400"},We={class:"p-4 text-center text-slate-900 dark:text-slate-100"},Xe={__name:"Index",props:{categories:Array,categoriesCount:Number,currentLocale:String,availableLocales:Array,errors:Object},setup(e){const{t:m}=M(),o=Y(),C=e,h=T([]);L(()=>C.categories,t=>{h.value=JSON.parse(JSON.stringify(t||[]))},{immediate:!0,deep:!0});const y=T(!1),A=T(null),_=T(""),S=t=>{A.value=t.id,_.value=t.title,y.value=!0},i=()=>{y.value=!1,A.value=null,_.value=""},n=()=>{if(A.value===null)return;const t=A.value,a=_.value;I.delete(route("admin.categories.destroy",{category:t}),{preserveScroll:!0,onSuccess:()=>{o.success(`Страница "${a||"ID: "+t}" удалена.`)},onError:l=>{const c=l.general||l[Object.keys(l)[0]]||"Произошла ошибка при удалении.";o.error(`${c} (Страница: ${a||"ID: "+t})`)},onFinish:()=>{i()}})},D=t=>{const a=!t.activity,l=m(a?"activated":"deactivated");I.put(route("admin.actions.categories.updateActivity",{category:t.id}),{activity:a},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{const c=(x,w,g)=>{for(const k of x){if(k.id===w)return k.activity=g,!0;if(k.children&&k.children.length>0&&c(k.children,w,g))return!0}return!1};c(h.value,t.id,a),o.success(`Страница "${t.title}" ${l}.`)},onError:c=>{o.error(c.activity||c.general||`Ошибка изменения активности для "${t.title}".`)}})},p=t=>{let a=[];const l=(x,w)=>{x.forEach((g,k)=>{let B=!1;g.sort!==k&&(g.sort=k,B=!0),g.parent_id!==w&&(B=!0),B&&a.push({id:g.id,sort:g.sort,parent_id:w}),g.children&&g.children.length&&l(g.children,g.id)})};l(h.value,null);const c=a.reduce((x,w)=>{const g=x.find(k=>k.id===w.id);return g?(Object.assign(g,w),x):x.concat([w])},[]);c.length>0?I.put(route("admin.actions.categories.updateSortBulk"),{categories:c,locale:C.currentLocale},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{o.success("Иерархия успешно обновлена")},onError:x=>{console.error("Ошибка обновления сортировки:",x),o.error(x.message||"Ошибка обновления иерархии"),I.reload({only:["categories"],preserveScroll:!0})}}):console.log("Никаких изменений в порядке сортировки нет.")},u=T([]),O=t=>{let a=[];return t.forEach(l=>{a.push(l.id),l.children&&l.children.length&&(a=a.concat(O(l.children)))}),a},j=t=>{var c;const a=(c=t.target)==null?void 0:c.checked,l=O(h.value);a===!0?u.value=l:a===!1&&(u.value=[])},J=t=>{const a=u.value.indexOf(t);a>-1?u.value.splice(a,1):u.value.push(t)},U=(t,a,l)=>{t.forEach(c=>{a.includes(c.id)&&(c.activity=l),c.children&&c.children.length&&U(c.children,a,l)})},q=t=>{if(!u.value.length){o.warning("Выберите страницы для активации/деактивации");return}const a=[...u.value];I.put(route("admin.actions.categories.bulkUpdateActivity"),{ids:a,activity:t},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{U(h.value,a,t),u.value=[],o.success("Статус активации массово обновлены")},onError:()=>{o.error("Произошла оштбка при массовом обновлении статуса активности")}})},P=t=>{const a=t.target.value;a==="selectAll"?j({target:{checked:!0}}):a==="deselectAll"?j({target:{checked:!1}}):a==="activate"?q(!0):a==="deactivate"&&q(!1),t.target.value=""},R=t=>route("admin.categories.index",{locale:t});return(t,a)=>(f(),V(le,{title:r(m)("categories")},{header:v(()=>[b(re,null,{default:v(()=>[E(d(r(m)("categories")),1)]),_:1})]),default:v(()=>[s("div",Ue,[s("div",qe,[s("div",ze,[b(oe,{href:t.route("admin.categories.create",{locale:e.currentLocale})},{icon:v(()=>[Fe]),default:v(()=>[E(" "+d(r(m)("addCategory")),1)]),_:1},8,["href"]),e.categoriesCount>0?(f(),V(ke,{key:0,onChange:P})):z("",!0)]),s("div",He,[s("div",Je,[s("span",Pe,d(r(m)("localization"))+": ",1),(f(!0),$(Z,null,ee(e.availableLocales,l=>(f(),V(r(F),{key:l,href:R(l),class:N(["px-3 py-1 text-sm font-medium rounded-sm",e.currentLocale===l?"bg-blue-500 text-white":"bg-slate-100 dark:bg-slate-900 text-slate-700 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-600"]),"preserve-scroll":"","preserve-state":""},{default:v(()=>[E(d(l.toUpperCase()),1)]),_:2},1032,["href","class"]))),128))]),s("div",Re,[e.categoriesCount?(f(),V(ne,{key:0},{default:v(()=>[E(d(e.categoriesCount),1)]),_:1})):z("",!0),s("input",{type:"checkbox",id:"select-all-header",onChange:j,class:"form-checkbox rounded-sm text-indigo-500 ml-2",title:r(m)("selectAll")},null,40,Ke)])]),s("div",Ge,[b(r(H),{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=l=>h.value=l),tag:"div","item-key":"id",handle:".handle",group:"categories",onEnd:p,class:"category-tree-root","data-parent-id":null},te({item:v(({element:l})=>[b(Me,{category:l,level:0,"selected-categories":u.value,onToggleActivity:D,onDelete:S,onToggleSelect:J,onRequestDragEnd:p},null,8,["category","selected-categories"])]),_:2},[h.value.length===0&&e.categoriesCount>0?{name:"header",fn:v(()=>[s("div",Qe,d(r(m)("loading"))+"... ",1)]),key:"0"}:void 0,h.value.length===0&&e.categoriesCount===0?{name:"footer",fn:v(()=>[s("div",We,d(r(m)("noData")),1)]),key:"1"}:void 0]),1032,["modelValue"])])])]),b(ce,{show:y.value,onClose:i,onCancel:i,onConfirm:n,cancelText:r(m)("cancel"),confirmText:r(m)("yesDelete")},null,8,["show","cancelText","confirmText"])]),_:1},8,["title"]))}},mt=ge(Xe,[["__scopeId","data-v-5f671a35"]]);export{mt as default};
