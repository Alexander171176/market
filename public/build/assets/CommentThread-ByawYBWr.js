import{u as M,l as x,z as B,a4 as F,m as o,n as f,o as a,f as e,t as l,k as n,F as C,v as z,q as Y,p as j,i as J,w as P,J as Z,N as G,O as K,I as S,ap as T}from"./vendor-CMULZhQa.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as U}from"./vendor-axios-jn5v1YEJ.js";const D=h=>(G("data-v-ec817d31"),h=h(),K(),h),W={key:0,class:"mt-4"},X={class:"mb-4 tracking-wide text-center font-semibold text-lg text-black dark:text-white"},ee={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2 gap-3"},te={class:"relative w-full bg-black aspect-video overflow-hidden"},se={key:0,class:"relative w-full h-full"},oe=["src","alt"],ae={class:"absolute inset-0 flex items-center justify-center z-20"},re=["onClick"],le=D(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-8 h-8 text-red-600",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8 5v14l11-7z"})],-1)),ne=[le],de=["innerHTML"],ce=["src"],ie={key:2,class:"w-full h-full object-contain",controls:""},ue=["src"],he={class:"text-center text-sm font-semibold text-slate-800 dark:text-slate-100 pt-1"},ve={class:"pb-2 flex items-center justify-center text-center text-xs text-slate-600 dark:text-slate-400"},me=D(()=>e("svg",{class:"w-3 h-3 fill-current shrink-0 mr-1",viewBox:"0 0 16 16"},[e("path",{d:"M15 2h-2V0h-2v2H9V0H7v2H5V0H3v2H1a1 1 0 00-1 1v12a1 1 0 001 1h14a1 1 0 001-1V3a1 1 0 00-1-1zm-1 12H2V6h12v8z"})],-1)),be={__name:"RecommendedVideos",props:{videos:Array},setup(h){const t=h,{t:_}=M(),y=x({}),E=x({}),w=x({}),V=(s,u)=>{g(s),u>1&&(w.value[s]=setInterval(()=>{y.value[s]=(y.value[s]+1)%u},4e3))},g=s=>{w.value[s]&&(clearInterval(w.value[s]),delete w.value[s])},$=s=>{E.value[s]=!0,g(s)},p=s=>{const u=s.source_type,r=s.external_video_id;try{if(u==="youtube"){let d=null;const m=new URL(r);if(d=m.searchParams.get("v"),!d&&m.hostname==="youtu.be"&&(d=m.pathname.slice(1)),!d&&m.pathname){const k=m.pathname.match(/(?:\/shorts\/|\/watch\/|\/)([a-zA-Z0-9_-]{11})/);d=k?k[1]:null}return d?`https://www.youtube.com/embed/${d}`:null}if(u==="vimeo"){const d=r.match(/vimeo\.com\/(?:video\/)?(\d+)/);return d?`https://player.vimeo.com/video/${d[1]}`:null}if(u==="local")return s.video_url||`/storage/${r}`;if(u==="code")return s.video_code||s.embed_code||null}catch(d){return console.error("❌ Video URL error:",d),null}return null};return B(()=>{t.videos.forEach(s=>{var u;y.value[s.id]=0,((u=s.images)==null?void 0:u.length)>1&&V(s.id,s.images.length)})}),F(()=>{t.videos.forEach(s=>g(s.id))}),(s,u)=>h.videos&&h.videos.length>0?(a(),o("div",W,[e("h2",X,l(n(_)("relatedVideos")),1),e("div",ee,[(a(!0),o(C,null,z(h.videos,r=>{var d;return a(),o("div",{key:r.id,class:"relative flex flex-col rounded overflow-hidden bg-slate-100 dark:bg-slate-700 border-2 border-slate-400 shadow-md shadow-gray-400 dark:shadow-gray-800"},[e("div",te,[(d=r.images)!=null&&d.length&&!E.value[r.id]?(a(),o("div",se,[(a(!0),o(C,null,z(r.images,(m,k)=>(a(),o("img",{key:m.id||k,src:m.url,alt:m.alt||r.title,class:Y(["slide-fade w-full h-full object-cover",{"slide-fade-active":k===y.value[r.id]}]),loading:"lazy"},null,10,oe))),128)),e("div",ae,[e("button",{onClick:m=>$(r.id),class:"bg-white/30 hover:bg-white/40 backdrop-blur-md rounded-full p-2 border-8 border-white/30"},ne,8,re)])])):(a(),o(C,{key:1},[r.source_type==="code"?(a(),o("div",{key:0,class:"w-full h-full",innerHTML:p(r)},null,8,de)):["youtube","vimeo"].includes(r.source_type)?(a(),o("iframe",{key:1,class:"w-full h-full",src:p(r),style:{width:"100% !important","aspect-ratio":"16 / 9 !important",display:"block !important"},frameborder:"0",allow:"autoplay; fullscreen; picture-in-picture",allowfullscreen:"",loading:"lazy"},null,8,ce)):r.source_type==="local"?(a(),o("video",ie,[e("source",{src:p(r),type:"video/mp4"},null,8,ue),j(" "+l(n(_)("videoNotSupported")),1)])):f("",!0)],64))]),e("div",he,[J(n(Z),{href:`/videos/${r.url}`,class:"block text-sm font-semibold text-slate-800 dark:text-slate-100 hover:text-red-600 hover:dark:text-red-400 transition"},{default:P(()=>[j(l(r.title),1)]),_:2},1032,["href"]),e("div",ve,[me,j(" "+l(r.published_at?new Date(r.published_at).toLocaleDateString():""),1)])])])}),128))])])):f("",!0)}},Qe=Q(be,[["__scopeId","data-v-ec817d31"]]),xe={class:"mt-4"},pe=e("svg",{class:"w-3 h-3 fill-current shrink-0 text-black dark:text-white",viewBox:"0 0 16 16"},[e("path",{d:"M8 0C3.6 0 0 3.1 0 7s3.6 7 8 7h.6l5.4 2v-4.4c1.2-1.2 2-2.8 2-4.6 0-3.9-3.6-7-8-7zm4 10.8v2.3L8.9 12H8c-3.3 0-6-2.2-6-5s2.7-5 6-5 6 2.2 6 5c0 2.2-2 3.8-2 3.8z"})],-1),_e={class:"mx-2 border-b dashed border-gray-400 font-semibold text-md text-black dark:text-white hover:text-red-500 dark:hover:text-yellow-300"},ye={class:"text-sm text-red-500 dark:text-yellow-300"},ke={key:0},fe={key:0,class:"text-sm text-gray-500"},ge={key:1,class:"text-red-500"},we={class:"flex justify-between items-center text-sm font-semibold"},$e={class:"text-blue-600 dark:text-blue-300"},Ce={class:"flex space-x-2 text-xs"},Ve=["onClick"],Ue=["onClick"],Ee=["onClick"],Se={key:0,class:"mt-2 space-y-1"},Te={class:"space-x-2"},je={key:1,class:"text-sm text-gray-800 dark:text-gray-200"},ze={key:2,class:"mt-2"},Ie=["placeholder"],Le={class:"space-x-2 mt-1"},He=["onClick"],Ne={key:3,class:"mt-3 pl-4 border-l-2 border-gray-400 space-y-2"},Re={class:"text-xs font-semibold text-purple-600 dark:text-purple-300"},Me={key:0},Be={class:"flex justify-end space-x-2 mt-1"},De={key:1,class:"text-sm text-gray-700 dark:text-gray-200"},Ae=["title","onClick"],qe=["title","onClick"],Oe={key:2,class:"mt-4 border-t pt-2"},Fe={class:"font-semibold mb-2 text-sm text-gray-800 dark:text-gray-200"},Ye=["placeholder"],Je={class:"mt-1 flex items-center justify-end"},Pe={key:3,class:"text-sm text-gray-500 mt-4"},We={__name:"CommentThread",props:{commentableType:{type:String,required:!0},commentableId:{type:Number,required:!0},authUser:{type:Object,default:null}},setup(h){const{t}=M(),_=h,y=x(!0),E=()=>{y.value=!y.value},w=x([]),V=x(!1),g=x(null),$=x(null),p=x(""),s=x(null),u=x(""),r=x(""),d=async()=>{var i,b;V.value=!0;try{const{data:c}=await U.get("/api/comments",{params:{commentable_type:String(_.commentableType),commentable_id:Number(_.commentableId)}});w.value=c}catch(c){console.error(t("commentErrorLoading"),c.response||c),(b=(i=c.response)==null?void 0:i.data)!=null&&b.message?g.value=`Ошибка: ${c.response.data.message}`:g.value=t("commentErrorLoading")}finally{V.value=!1}},m=i=>{$.value=i.id,p.value=i.content},k=()=>{$.value=null,p.value=""},L=async()=>{try{await U.put(`/api/comments/${$.value}`,{content:p.value}),k(),await d()}catch{alert(t("robotError"))}},H=async i=>{if(confirm(t("commentDelete")))try{await U.delete(`/api/comments/${i}`),await d()}catch{alert(t("commentDeleteError"))}},A=i=>{s.value=i,u.value=""},N=()=>{s.value=null,u.value=""},q=async i=>{try{await U.post("/api/comments",{commentable_type:_.commentableType,commentable_id:_.commentableId,parent_id:i,content:u.value}),N(),await d()}catch{alert(t("commentErrorResponse"))}},O=async()=>{if(r.value.trim())try{await U.post("/api/comments",{commentable_type:_.commentableType,commentable_id:_.commentableId,content:r.value}),r.value="",await d()}catch(i){i.response&&i.response.data&&i.response.data.errors?(console.error("Validation errors:",i.response.data.errors),alert(Object.values(i.response.data.errors).join(`
`))):(console.error(t("commentErrorSending"),i),alert(t("commentErrorAdding")))}};return B(d),(i,b)=>(a(),o("div",xe,[e("h3",{class:"mb-2 flex items-center justify-center text-center cursor-pointer select-none",onClick:E},[pe,e("span",_e,l(n(t)("comments")),1),e("span",ye,l(y.value?"▲":"▼"),1)]),y.value?(a(),o("div",ke,[V.value?(a(),o("div",fe,l(n(t)("uploadingComments")),1)):f("",!0),g.value?(a(),o("div",ge,l(g.value),1)):f("",!0),(a(!0),o(C,null,z(w.value,c=>{var R;return a(),o("div",{key:c.id,class:"border p-3 rounded bg-gray-50 dark:bg-slate-800"},[e("div",we,[e("span",$e,l(c.user.name),1),e("div",Ce,[e("button",{onClick:v=>A(c.id),class:"text-blue-500"},l(n(t)("reply")),9,Ve),h.authUser&&h.authUser.id===c.user.id?(a(),o(C,{key:0},[e("button",{onClick:v=>m(c),class:"text-green-500"},l(n(t)("edit")),9,Ue),e("button",{onClick:v=>H(c.id),class:"text-red-500"},l(n(t)("delete")),9,Ee)],64)):f("",!0)])]),$.value===c.id?(a(),o("div",Se,[S(e("textarea",{"onUpdate:modelValue":b[0]||(b[0]=v=>p.value=v),class:"w-full border rounded p-1 text-sm"},null,512),[[T,p.value]]),e("div",Te,[e("button",{onClick:L,class:"text-green-600"},l(n(t)("save")),1),e("button",{onClick:k,class:"text-gray-500"},l(n(t)("cancel")),1)])])):(a(),o("div",je,l(c.content),1)),s.value===c.id?(a(),o("div",ze,[S(e("textarea",{"onUpdate:modelValue":b[1]||(b[1]=v=>u.value=v),class:"w-full border rounded p-1 text-sm",placeholder:n(t)("commentYourAnswer")},null,8,Ie),[[T,u.value]]),e("div",Le,[e("button",{onClick:v=>q(c.id),class:"text-blue-600"},l(n(t)("send")),9,He),e("button",{onClick:N,class:"text-gray-500"},l(n(t)("cancel")),1)])])):f("",!0),(R=c.replies)!=null&&R.length?(a(),o("div",Ne,[(a(!0),o(C,null,z(c.replies,v=>(a(),o("div",{key:v.id},[e("div",Re,l(v.user.name),1),$.value===v.id?(a(),o("div",Me,[S(e("textarea",{"onUpdate:modelValue":b[2]||(b[2]=I=>p.value=I),class:"w-full px-2 py-0.5 rounded text-sm border border-gray-400 bg-slate-100 dark:bg-slate-700 text-black dark:text-white"},null,512),[[T,p.value]]),e("div",Be,[e("button",{onClick:L,class:"border border-gray-600 dark:border-gray-300 text-xs text-black dark:text-slate-100 hover:text-white dark:hover:text-white hover:bg-blue-600 dark:hover:bg-blue-900 transition-colors duration-200 ease-in-out rounded-sm px-2 py-0.5 font-semibold"},l(n(t)("save")),1),e("button",{onClick:k,class:"border border-gray-600 dark:border-gray-300 text-xs text-black dark:text-slate-100 hover:text-white dark:hover:text-white hover:bg-gray-600 dark:hover:bg-black transition-colors duration-200 ease-in-out rounded-sm px-2 py-0.5 font-semibold"},l(n(t)("cancel")),1)])])):(a(),o("div",De,[j(l(v.content)+" ",1),h.authUser&&h.authUser.id===v.user.id?(a(),o(C,{key:0},[e("button",{class:"mr-2 font-semibold hover:opacity-75 text-xs text-teal-700 dark:text-teal-300 border-b border-dashed border-teal-700 dark:border-teal-300",title:n(t)("edit"),onClick:I=>m(v)},l(n(t)("edit")),9,Ae),e("button",{class:"font-semibold hover:opacity-75 text-xs text-red-600 dark:text-red-300 border-b border-dashed border-red-600 dark:border-red-300",title:n(t)("delete"),onClick:I=>H(v.id)},l(n(t)("delete")),9,qe)],64)):f("",!0)]))]))),128))])):f("",!0)])}),128)),h.authUser?(a(),o("div",Oe,[e("h4",Fe,l(n(t)("commentLeave")),1),S(e("textarea",{"onUpdate:modelValue":b[3]||(b[3]=c=>r.value=c),class:"w-full px-2 py-0.5 rounded text-sm border border-gray-400 bg-slate-100 dark:bg-slate-700 text-black dark:text-white",placeholder:n(t)("commentYour")},null,8,Ye),[[T,r.value]]),e("div",Je,[e("button",{onClick:O,class:"border border-gray-600 dark:border-gray-300 text-xs text-black dark:text-slate-100 hover:text-white dark:hover:text-white hover:bg-blue-600 dark:hover:bg-blue-900 transition-colors duration-200 ease-in-out rounded-sm px-2 py-0.5 font-semibold"},l(n(t)("send")),1)])])):(a(),o("div",Pe,l(n(t)("commentLogin")),1))])):f("",!0)]))}};export{Qe as R,We as _};
